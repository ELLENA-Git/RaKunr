> 本篇文章乃 Rakume 这个渣渣在 [@Consiiii](http://consiiii.me)， [@Skimige](http://ikevin.in)，[@Cee](https://blog.cee.moe) 的帮助和指导下，和在自己的理解的基础上翻译的，与原文略有出入。还请大家随意吐槽，这样才能有所进步，感谢。
>
> Original Post: [What's New in jQuery 3](http://developer.telerik.com/featured/whats-new-in-jquery-3/?utm_source=javascriptweekly&utm_medium=email)

***

自从 jQuery 开始风靡一世已经过了十年了，但由于它的易用性，以至于现在是十分流行的一个框架。jQuery 给开发者提供了一个易于使用的集合，包括了 DOM 交互，Ajax 请求，动画和许多其他方面。同时，它又不同于 DOM API，jQuery 在操作 DOM 的基础上，实现了[组合模式](https://addyosmani.com/resources/essentialjsdesignpatterns/book/#compositepatternjquery)，所以，你才能够直接调用 jQuery 的集合所提供的方法，无论这个集合的元素的数量是多少。

jQuery 3 将在近几周发布，那将会是一个重要的里程碑。所以，为了介绍和尽快地了解 jQuery 3，本篇文章正是要论述 jQuery 3 最重要的变化。



## 新功能 & 新特性

在下面几个部分中，我们将要了解 jQuery 3 新增的一些最有影响的功能和特性。

### FOR … OF LOOP

在 jQuery 3 你可以使用 `for … of loop` 来遍历 DOM 元素。`for … of loop ` 是一种新的迭代器，乃 ECMAScript 2015 （又称 ECMAScript 6 或 ES6）的规范。它可以帮助你遍历所有的对象（包括 `Array`, `Map`, `Set`, 等等），而不区别对待。

当你在使用这种迭代器的时候，你从 jQuery 接受到的不仅仅是一个 DOM 元素，而是一个可以在同一时间访问一个元素的 jQuery 集合。这个迭代器给你带来了一个操作 jQuery 集合的不同方式。

为了方便理解它是如何工作的，我们得亲自体验一番，下面是一个分配 ID 的实例。



在还没有接触 jQuery 3 之前，你的写法可能是：	

```javascript
var $inputs = $('input');
for (var i = 0; i < $inputs.length; i++) {
   $inputs[i].id = 'input-' + i;
}
```

但有了 jQuery 3 那么，你可以这样写：

```javascript
var $inputs = $('input');
var i = 0; 

for(var input of $inputs) {
   input.id = 'input-' + i++;
}
```

> 通过这两个实例的对比，我们能很直观的了解到这两种写法的特点。



### 新的别名函数 `$.GET()` 与 `$.POST()`

> 为了更好理解我这里把 `$.get()` 和 $.`post()` 称为别名函数。



jQuery 3 中，添加了 `$.get()` 与 `$.post()` 这两个新的辅助函数，他们的用法是：

```javascript
$.get([settings])
$.post([settings])
```



这里的 `settings` 是一个描述的是请求属性的对象。它与 `$.ajax() ` 所需要的基本属性一致。但如果您还不大了解 `$.ajax()` 这个函数，请[点击这里](http://api.jquery.com/jquery.ajax/#jQuery-ajax-settings)。

它们的唯一区别是，`$.ajax()` 的 `method` 可以改变，而 `$.get()` 与 `$.post()` 不能。`$.get()` 、 `$.post()`  都已经预设好了 HTTP method（`$.get()` 为 `GET`，`$.post()` 为 `POST`）。简单说，你没有办法通过 `$.get()` 执行一个 `POST` 请求。



废话不多说，直接上代码：

```javascript
$.get({
   url: 'https://www.audero.it',
   method: 'POST' // 这个属性会被忽略
});
```

> 尽管传入了 `method` 这个属性，但它依然会发送 `GET` 请求，而不是 `POST` 请求。



###使用 `REQUESTANIMATIONFRAME()` 来渲染动画

[requestAnimationFrame](http://caniuse.com/#feat=requestanimationframe) 的兼容性十分不错，包括所有的现代浏览器，IE 10 以及以上的版本都能很好的支持。并且，这个函数的运用，减少了 CPU 的密集操作，可使动画的渲染更加流畅。

> 不过，Rakume 渣渣在这里建议，动画还是尽量使用 CSS 来渲染。使用 CSS 能开启 GPU 加速，这能使动画的流畅度进一步。



### UNWRAP()

jQuery 3 中给 `unwrap() ` 添加了一个*（可选）*参数，它是这样使用的：

```javascript
unwrap([selector])
```

`selector` 即父元素的选择器，执行此函数的时候，jQuery 会对其进行匹配。如果匹配成功，子元素就会被展开，否则，保持不变。



## 功能与特性上的修改

### `:VISIBLE` & `:HIDDEN`

jQuery 3 的选择器对 `:visible` 与 `:hidden` 这两个修饰符的选择范围进行了修改。任何的盒模型都被视为 `:visible`，包括那些零宽度或零高度的。

比如说 `<br>` 这个元素，还有其他的无内容的内联元素，都会被 `:visible` 选中。

>盒模型，这个我不确定 "layout boxes" 的翻译是不是这个，求大神指点。不过这里大概指的是非 `display: none` 类的元素。



当然，嘴皮子说说，不如实验来的实际。首先先建立一个 HTML：

```html
<div></div>
<br>
```

然后，在控制台里执行以下代码：

```javascript
// jQuery 1.x / 2.x
console.log($('body :visible').length);
// => 0

// jQuery 3
console.log($('body :visible').length);
// => 2
```

结果，就如上面的代码里的注释一样，很好理解吧。



### DATA()

jQuery 3 中的另一个重要的修改就是 `data()` 的命名，现在，它依赖得是 [Dataset API specifications](http://www.w3.org/TR/html5/dom.html#dom-dataset)。所以 jQuery 3 会把所有的键名转化为**驼峰命名** *（hello-world => helloWorld）*的格式。



为了理解何为**驼峰命名**，那就来看看吧：

```html
<div id="container"></div>
<script>
function test()
{
  var $elem = $('#container');

  $elem.data({
     'my-property': 'hello'
  });

  console.log($elem.data());
}
</script>
```

打开控制台，执行。

```javascript
// jQuery 1.x / jQuery 2.x
test()
// => {my-property: "hello"}

// jQuery 3
test()
// => {myProperty: "hello"}
```

> 需要注意的是，驼峰命名的格式只是 jQuery 3 的特性。而在 jQuery 3 往前的版本中，它是不会进行修改的。



### DEFERRED

jQuery 3 将 Deferred 升级成与 [Promise/A+ proposal](https://promisesaplus.com/) 和 [ES2015 Promises](http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects) 相兼容，想要了解更多关于jQuery.Deferred 的信息，你可以阅读 [官方文档](https://api.jquery.com/category/deferred-object/) 或者 Aurelio De Rosa 的涉及 jQuery 3 的书籍  [*jQuery in Action, third edition*](https://www.manning.com/books/jquery-in-action-third-edition)。

在 jQuery 1.x 和 2.x 中， `Deferred` 中的回调函数一旦出现异常就会立刻终止程序的运行。而在原生的 `Promise` 中，若抛出异常，则会一直向上寻找能处理异常的函数，直到 `window.onerror`，如果届时还是无法处理，进程才会罢工，抛出错误信息。

jQuery 3 遵循原生 `Promise` 处理错误的模式。因此，如果抛出异常，它会先通知 "这里发生了错误"，随之执行错误回调（即 `reject`） 。一旦完成对错误的处理，进程就会继续执行，而不中断。



为了更好的理解这两种的区别，让我们来做点小实验，代码如下：

```javascript
var deferred = $.Deferred();

deferred
  .then(function() {
    throw new Error('An error');
  })
  .then(
    function() {
      console.log('Success 1');
    },
    function() {
      console.log('Failure 1');
    }
  )
  .then(
    function() {
      console.log('Success 2');
    },
    function() {
      console.log('Failure 2');
    }
  );

deferred.resolve();
```



以上的代码，我们会的到的结果是这样的：

```javascript
// jQuery 1.x / jQuery 2.x
deferred.resolve();
// Uncaught Error: An Error(…)

// jQuery 3
deferred.reslove();
// Failure 1
// Success 2
```



> 在 jQuery 1.x 和 jQuery 2.x 中，只有第一个（抛出错误的）函数会被执行。此外，我没有定义处理错误的函数，所以控制台会直接抛出 "Uncaught Error: An error"，并且进程结束。


> 但在 jQuery 3 中，在控制台上，你看到的是 "Failure 1" 和 "Success 2"。也就是说，在执行对第一个函数的错误处理后，会继续向下执行，而不是中断进程。



### SVG 文件

jQuery 没有一个版本（包括 jQuery 3）正式支持 SVG 文件。但事实上，许多方法都还是能正常执行的。还有其他一些方法，比如，操控类的方法，在 jQuery 3 中已经实现了对 SVG 文件的操作。因此，你可以使用 jQuery 3 的这些方法来操控 SVG，比如 `addClass()` 与 `hasClass()`。



## 废除和移除的方法与属性

到目前为止，除了目前已经描述的几个改进，jQuery 同时还废除了少许特性。



###   `BIND()`、`UNBIND()`、`DELEGATE()` 、`UNDELEGATE()` 的移除

`on()` 与 `off()` 这两个方法的引入也有了一段时间，官方推崇使用 `on()` 来取代`bind()`、`delegate()`、`live()` 这些陈旧的方法，用 `off()` 来取代 `unbind()` 、`undelegated()`、 `die()`。

在 jQuery 3 中，官方将会把这些不赞成的方法移除。使用 `on()` 和 `off()` 方法的童鞋，不用担心接下来的发行版与你的项目不兼容。



###  `LOAD()`、`UNLOAD()` 、`ERROR()` 方法的移除

除了上述的几个方法之外，jQuery 3 还将 `load()`、`unload()` 和 `error()` 给移除了。 这些方法早在 jQuery 1.8 被弃用，但是它们还没有被移除。所以，如果你还在你的项目中使用它们，或者依赖其中之一或几个的插件，那么升级到 jQuery 3，会让你的代码工作异常。所以，在升级的时候小心点。



### `CONTEXT`、`SUPPORT`、`SELECTOR` 属性的移除

除此之外，jQuery 3 还将 `context` ， `support` 和 `selector` 这三个属性移除。正如我在上一节中所提到的，如果你还在你的项目中使用它们，或者依赖其中之一或几个的插件，升级到 jQuery 3 将使你的代码工作异常。



## BUG 修复

jQuery 3 修复了一些以前的版本遗留的重要的 BUG，在下面的这部分内容，我会给你详细的讲解 jQuery 修复的两个重要的 bug。



### `width()` & `height()` 不再取近似值

jQuery 3 修复了 `width()`、 `height()` 和其他一些相关方法关于取近似值的问题， 这个问题造成了在一些特定的情景下定位。

为了理解这个问题，我们再来利用实例分析。首先，建立一个 宽 `100px` 的容器元素，然后里面放 3 个 宽为 1/3 （即 33.333333%）的元素，如下所示：

```html
<div class="container">
   <div>My name</div>
   <div>is</div>
   <div>Aurelio De Rosa</div>
</div>
```

假设你用的是 jQuery 3 以前的版本，并尝试取子元素的宽度：

```javascript
$('.container div').width();
```


……你会发现，你得到的值是 `33`，因为**在 jQuery 3 之前**会取 33.33333 的近似值，而在 jQuery 3 中，它已经被修复了，所以你会获得一个更准确的值(例如浮点数)。



### WRAPALL()

jQuery 的新版本修复了传递一个函数给  `wrapAll()`  时会发生的错误。在 jQuery 3 之前，当我们给 `wrapAll()` 传一个函数时，它会将 jQuery 集合中的元素都包裹起来，换句话说，它的作用和传递一个函数给 `wrap()` 的效果是一样的。



## 下载 jQuery 3 beta 1

您对 jQuery 3 产生了兴趣？想尝试一下它？那就快来下载吧。

1）您可以通过访问以下两个 URL 之一来获取它：

无压缩版: <https://code.jquery.com/jquery-3.0.0-beta1.js>
压缩版: <https://code.jquery.com/jquery-3.0.0-beta1.min.js>

2）您可以通过命令行，使用 `npm` 来安装：

```
npm install jquery@3.0.0-beta1
```



## 结论

许多人觉得 jQuery 已经不适用了，它不再在现代化 Web 开发占有一席之地。然而，它还在继续发展，并且 jQuery 的使用率（在世界前一百万的站点中使用率为 78.5%）又与那些人说法相悖。

在这篇文章中，我已经带你体验过了 jQuery 3 将会有的特性。正如你所注意到的，这个版本不会使你的已有的项目工作异常，因为它不需要重大的修改。尽管如此，对于 `Deferred` 的升级还是有一些地方需要去注意。事实总是如此，在更新一个第三方依赖之前，项目的审查能帮助你发现异常行为和损坏的功能。